<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta name="description" content="
    In normal conditions, an AWS load balancer will only route requests to healthy instances in its linked target group.
">

        <link rel="shortcut icon" href="https://til.codeinthehole.com/favicon.ico">

        
            

        
        <link rel="stylesheet" href="/css/main.min.css">

        
<meta property="og:type" content="article" />
<meta property="og:url" content="https://til.codeinthehole.com/posts/aws-target-groups-fail-open-when-all-instances-are-unhealthy/" />
<meta property="og:title" content="TIL AWS target groups fail open when all instances are unhealthy — David Winterbottom" />
<meta property="og:description" content="In normal conditions, an AWS load balancer will only route requests to healthy instances in its linked target group. — can be read in 1 minute" />


<meta property="og:image" content="https://til.codeinthehole.com/images/site.png" />


        <title>
    TIL AWS target groups fail open when all instances are unhealthy — David Winterbottom
</title>

        
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-4500T4RE03"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {dataLayer.push(arguments); }

            
            window['ga-disable-G-4500T4RE03'] = location.hostname != "til.codeinthehole.com"
            gtag('js', new Date());
            gtag('config', 'G-4500T4RE03');
        </script>

    </head>

    <body>
        
            <header id="banner">
                <h2><a href="https://til.codeinthehole.com/">Today I Learnt&hellip;</a></h2>
            </header>
        

        <main id="content">
            
    <article>
        <header id="post-header">
            <div id="date_sentence">
                On <time>September 24, 2022</time>, <a href="https://codeinthehole.com" title="that is, David Winterbottom">I</a> learnt ...
            </div>
            <h1>AWS target groups fail open when all instances are unhealthy</h1>
        </header><p>In normal conditions, an AWS load balancer will only route requests to healthy
instances in its linked target group. But a &ldquo;fail open&rdquo; policy is applied if all
targets in the target group are unhealthy. From the <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/target-group-health-checks.html">AWS ELB docs</a>:</p>
<blockquote>
<p>If a target group contains only unhealthy registered targets, the load
balancer routes requests to all those targets, regardless of their health
status. This means that if all targets fail health checks at the same time in
all enabled Availability Zones, the load balancer fails open. The effect of
the fail-open is to allow traffic to all targets in all enabled Availability
Zones, regardless of their health status, based on the load balancing
algorithm.</p>
</blockquote>
<p>This came up at Kraken Tech where an unusual misconfiguration caused all
instances in a target group to become unhealthy, and I was initially puzzled as
to why new instances — which had never passed their health checks — were serving
production traffic.</p>
</article>

        </main>

        
    <footer id="footer">

        
        

        
        
        

            
            

            
                

                
                    <p>Other things learnt about <a href="/tags/aws/">AWS</a>:</p>
                    <ul>
                        
                            <li><a href="/posts/python-tests-using-moto-should-be-explicit-about-aws-regions/">Python tests using <code>moto</code> should be explicit about AWS regions</a></li>

                            
                            
                        
                            <li><a href="/posts/that-aws-aurora-clusters-have-two-types-of-storage/">That AWS Aurora clusters have two types of storage</a></li>

                            
                            
                        
                            <li><a href="/posts/how-to-use-awsmfav2-to-avoid-entering-so-many-mfa-tokens/">How to use <code>aws-mfa-v2</code> to avoid entering so many MFA tokens</a></li>

                            
                            
                        
                            <li><a href="/posts/you-can-have-ssh-sessions-via-aws-session-manager/">You can have SSH sessions via AWS Session Manager</a></li>

                            
                            
                        
                            <li><a href="/posts/how-to-use-aws-profiles-that-require-mfa/">How to use AWS profiles that require MFA</a></li>

                            
                            
                        
                            <li><a href="/posts/aws-asgs-have-an-instance-refresh-feature/">AWS ASGs have an &lsquo;instance refresh&rsquo; feature</a></li>

                            
                            
                        
                            <li><a href="/posts/theres-a-chrome-extension-for-switching-aws-iam-roles/">There&rsquo;s a Chrome extension for switching AWS IAM roles</a></li>

                            
                            
                        
                            <li><a href="/posts/aws-availability-zones-have-counterintuitive-ids/">AWS Availability Zones have counter-intuitive IDs</a></li>

                            
                            
                        
                            <li><a href="/posts/about-passwordless-users-in-ec2/">Where authentication for the <code>ubuntu</code> user on a EC2 instance is defined</a></li>

                            
                            
                        
                    </ul>
                

            

        

        <br/>

        
        
        
            <p>Jump to the previous/next TIL using the left/right cursor keys.</p>
        
    </footer>


        
    <script src="//cdnjs.cloudflare.com/ajax/libs/mousetrap/1.4.6/mousetrap.min.js"></script>
    <script>
        
            Mousetrap.bind("left", function() { window.location.replace("\/posts\/how-ripgrep-interprets-gitignore-rules-changes-when-a-filepath-argument-is-used\/"); })
        

        
            Mousetrap.bind("right", function() { window.location.replace("\/posts\/which-behaves-diffferently-in-zsh-compared-to-bash\/"); })
        
    </script>

    </body>
</html>
